import { ToggleDocsImage } from "../../../components/docs/Image";
import staticSrcImg  from "../../../../public/images/docs/static-src-fail.PNG"
import staticSrcImgLog  from "../../../../public/images/docs/static-src-fail-log.png"

# β›” μ΄μ 10 : κ΄€λ¦¬ν• μ±λ¦°μ§€μ Next.js μ •μ  λ¦¬μ†μ¤ μ°¨λ‹¨

### π“ **μƒν™© μ„¤λ…**

<div className="mt-4">
  <ToggleDocsImage src={staticSrcImg}/>
</div>

- νμ΄μ§€λ¥Ό μ²μ λ°©λ¬Έν•λ©΄ μ¤νƒ€μΌκ³Ό μ¤ν¬λ¦½νΈκ°€ μ μ©λμ§€ μ•μΌλ©°, **λΈλΌμ°μ € μ½μ†”μ—μ„ MIME Type μ¤λ¥κ°€ λ°μƒ**ν•¨.
- κ΄€λ¦¬ν• μ±λ¦°μ§€λ¥Ό ν†µκ³Όν• ν›„ λ‹¤μ‹ κ°™μ€ νμ΄μ§€λ¥Ό λ°©λ¬Έν•λ©΄ μ •μƒμ μΌλ΅ λ΅λ“λ¨.
- ν•΄λ‹Ή λ¬Έμ λ” UX κ°μ„ μ„ μ„ν•΄ [ν΄λΌμ°λ“ν”λ μ–΄μ κ΄€λ¦¬ν• μ±λ¦°μ§€](https://developers.cloudflare.com/waf/reference/cloudflare-challenges/#managed-challenge-recommended)λ¥Ό<br/> λ©”μΈ νμ΄μ§€, λ¬Έμ„ νμ΄μ§€ λ“± **API μ”μ²­μ΄ μ—†λ” νμ΄μ§€μ—μ„ μ μ™Έ**ν•λ©΄μ„ λ°μƒ.

---

### π” **μ›μΈ λ¶„μ„**

1. **Cloudflare μ±λ¦°μ§€κ°€ Next.jsμ `_next/static/*` λ¦¬μ†μ¤λ¥Ό μ°¨λ‹¨**
     - Next.jsλ” `_next/static/*` κ²½λ΅λ¥Ό ν†µν•΄ μ •μ  λ¦¬μ†μ¤λ¥Ό μ κ³µν•λ”λ°, Cloudflareμ—μ„ κ΄€λ¦¬ν• μ±λ¦°μ§€κ°€ ν™μ„±ν™”λ μƒνƒμ—μ„λ” **μ΄ κ²½λ΅μ— λ€ν• μ”μ²­μ΄ μ±λ¦°μ§€λ¥Ό ν†µκ³Όν•μ§€ λ»ν•κ³  μ°¨λ‹¨λ¨**.
     - μ¦‰, μ²μ λ°©λ¬Έν•λ” μ‚¬μ©μμ κ²½μ° `_next/static/*` κ²½λ΅μ js/css νμΌμ΄ λΈλΌμ°μ €μ—μ„ λ΅λ“λμ§€ μ•μ.

2. **κ΄€λ¦¬ν• μ±λ¦°μ§€λ¥Ό ν†µκ³Όν• ν›„μ—λ” μ •μƒμ μΌλ΅ λ΅λ“λ¨**
     - ν΄λΌμ°λ“ν”λ μ–΄ μ±λ¦°μ§€κ°€ ν• λ² ν†µκ³Όλ IPλ” μΌμ • μ‹κ°„ λ™μ• μ‹ λΆ°ν•  μ μλ” μ‚¬μ©μλ΅ μΈμ‹λλ―€λ΅, μ΄ν›„ μ”μ²­μ€ μ •μƒμ μΌλ΅ μ²λ¦¬λ¨.
     - κ²°κ³Όμ μΌλ΅, **κ°™μ€ νμ΄μ§€λΌλ„ "μ²μ λ°©λ¬Έ μ‹"μ™€ "κ΄€λ¦¬ν• μ±λ¦°μ§€ ν†µκ³Ό ν›„"μ λ™μ‘μ΄ λ‹¤λ¥΄κ² λ‚νƒ€λ‚¨**.

---

### π› οΈ **ν•΄κ²° λ°©μ•**

1. **Cloudflare κ΄€λ¦¬ν• μ±λ¦°μ§€ μ„¤μ • μμ •**
     - `_next/static/*` κ²½λ΅λ¥Ό μ±λ¦°μ§€ μμ™Έ κ²½λ΅λ΅ μ„¤μ •ν•μ—¬ **Next.js μ •μ  λ¦¬μ†μ¤κ°€ ν•­μƒ μ •μƒμ μΌλ΅ λ΅λ“λλ„λ΅ λ³€κ²½**.
     - `_next/static/*` κ²½λ΅κ°€ λ³΄μ•μƒ μ„ν‘μ΄ λ  κ°€λ¥μ„±μ΄ κ±°μ μ—†κΈ° λ•λ¬Έμ—, μ΄ κ²½λ΅λ” μ±λ¦°μ§€ λ€μƒμ—μ„ μ μ™Έν•΄λ„ λ¬΄λ°©ν•¨.
2. **Next.js `next.config.mjs`μ— `_next/static/*` κ²½λ΅ κ΄€λ ¨ ν—¤λ” μ„¤μ • μ¶”κ°€**
     - Cloudflareλ¥Ό κ±°μΉμ§€ μ•λ” λ‹¤λ¥Έ ν™κ²½μ—μ„λ„ μ•μ •μ μΌλ΅ λ™μ‘ν•λ„λ΅ `Cache-Control` μ„¤μ •μ„ μ¶”κ°€.

```js
   async headers() {
     return [
       {
         source: "/_next/static/:path*",
         headers: [
           { key: "Access-Control-Allow-Origin", value: "https://noteapp.org" },
           { key: "Cache-Control", value: "public, max-age=31536000, immutable" },
         ],
       },
     ];
   },

```


---

### β… **κ²°κ³Ό**

1. `_next/static/*` κ²½λ΅λ¥Ό κ΄€λ¦¬ν• μ±λ¦°μ§€ μμ™Έ μ²λ¦¬ν• ν›„, **νμ΄μ§€ μµμ΄ λ°©λ¬Έ μ‹μ—λ„ μ •μ  λ¦¬μ†μ¤κ°€ μ •μƒμ μΌλ΅ λ΅λ“λ¨**.
2. Next.jsμ μ¤νƒ€μΌ λ° μ¤ν¬λ¦½νΈ λ΅λ”© μ¤λ¥ ν•΄κ²°.
3. λΈλΌμ°μ € μ½μ†”μ—μ„ λ” μ΄μƒ `Refused to execute script` λ° `text/html MIME type` μ¤λ¥κ°€ λ°μƒν•μ§€ μ•μ.

---

### π’΅ **λ°°μ΄ μ **

1. **"λ³΄μ• μ •μ±…μ„ λ³€κ²½ν•  λ•, λ³΄μ•κ³Ό UXμ κ· ν•μ„ κ³ λ ¤ν•΄μ•Ό ν•λ‹¤."**
    - μ±λ¦°μ§€λ¥Ό μ μ©ν•  λ•, **API μ”μ²­μ΄ μ—†λ” νμ΄μ§€λΌλ„ μ •μ  λ¦¬μ†μ¤κ°€ μν–¥μ„ λ°›μ„ μ μμ**μ„ ν™•μΈν•¨.

2. **"Cloudflare λ° Next.jsμ μ •μ  λ¦¬μ†μ¤ λ΅λ”© λ°©μ‹μ— λ€ν• μ΄ν•΄κ°€ ν•„μ”ν•λ‹¤."**
    - Cloudflareμ λ³΄μ• μ„¤μ •μ΄ Next.jsμ `_next/static/*` κ²½λ΅λ¥Ό μ–΄λ–»κ² μ²λ¦¬ν•λ”μ§€ μ§μ ‘ ν™•μΈν•΄λ³΄λ©΄μ„, λ³΄μ• μ •μ±…μ΄ μ›Ήμ‚¬μ΄νΈ λ™μ‘ λ°©μ‹μ— λ―ΈμΉλ” μν–¥μ„ κ²½ν—ν•¨.

3. **"λΉ λ¥΄κ² μ›μΈμ„ νμ•…ν•λ” λ¥λ ¥μ€ κ²½ν—μ—μ„ λ‚μ¨λ‹¤."**
    - MIME Type μ¤λ¥λ§ λ³΄κ³  CORS λ¬Έμ λ‚ Next.jsμ λΉλ“ λ¬Έμ λ΅ μ°©κ°ν•  μλ„ μμ—μ§€λ§,<br/>"κ΄€λ¦¬ν• μ±λ¦°μ§€ μ μ© λ²”μ„ λ³€κ²½"κ³Ό "Next.jsμ `_next/static/*` μ°¨λ‹¨" κ°„μ κ΄€κ³„λ¥Ό λΉ λ¥΄κ² μΊμΉν• κ²ƒμ΄ ν•µμ‹¬μ΄μ—λ‹¤.