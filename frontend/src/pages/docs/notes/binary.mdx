import {DocsImage} from '../../../components/docs/Image';
import dimg from "../../../lib/docsImages";

## ğŸš€ ì»¨í…ì¸  ë°ì´í„° ìµœì í™” ë° /sync/all ì••ì¶• ìµœì í™” ì¶”ê°€

<div className="max-h-96 overflow-auto border-y rounded-md mt-8">

```json filename="sampleData.json"

{
  "type": "doc",
  "content": [
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "ì´ê²ƒì€ Plate Editorì—ì„œ ì‘ì„±ëœ ë…¸íŠ¸ì˜ ì˜ˆì œì…ë‹ˆë‹¤."
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "Plate EditorëŠ” JSON í˜•íƒœë¡œ ë¬¸ì„œë¥¼ ì €ì¥í•©ë‹ˆë‹¤."
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "ëª©ë¡ í•­ëª© 1"
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "ëª©ë¡ í•­ëª© 2"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "blockquote",
      "content": [
        {
          "type": "paragraph",
          "content": [
            {
              "type": "text",
              "text": "ì´ê²ƒì€ ì¸ìš©ë¬¸ ì˜ˆì œì…ë‹ˆë‹¤.",
              "marks": [
                {
                  "type": "italic"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "codeBlock",
      "attrs": { "language": "javascript" },
      "content": [
        {
          "type": "text",
          "text": "console.log('Hello, World!');"
        }
      ]
    }
  ]
}


```

</div>

<span className="flex justify-center my-8">

*Plate ì—ë””í„°ëŠ” ì´ëŸ° JSON í˜•íƒœë¡œ ë°ì´í„°ë¥¼ ì €ì¥í•œë‹¤.*

</span>


### ğŸ“ ê°œìš”
Plate ì—ë””í„°ëŠ” JSON ê¸°ë°˜ì˜ ë¬¸ì„œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ë¯€ë¡œ, ë°ì´í„° í¬ê¸°ë¥¼ ìµœì†Œí™”í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤.
ì´ë¥¼ ìœ„í•´ ë…¸íŠ¸ ê°œë³„ `content` í•„ë“œëŠ” ë°”ì´ë„ˆë¦¬ ì••ì¶•í•˜ì—¬ ì €ì¥í•˜ê³ ,
**ëŒ€ëŸ‰ì˜ JSON ë°ì´í„°ë¥¼ ë™ê¸°í™”í•  ë•ŒëŠ”** `/sync/all` ìš”ì²­ì„ Gzip ì••ì¶•í•˜ì—¬ ë„¤íŠ¸ì›Œí¬ ë¹„ìš©ì„ ì ˆê°í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ìµœì í™”í•˜ì˜€ë‹¤.

---

## ğŸ” ë¶„ì„
1. **Plate ì—ë””í„°ì˜ íŠ¹ì„±**
    - Plate ì—ë””í„°ëŠ” í…ìŠ¤íŠ¸ì— ë©”íƒ€ë°ì´í„°ë¥¼ í¬í•¨í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì‘ë™í•˜ê¸° ë•Œë¬¸ì— ë¬¸ì„œë¥¼ JSON í˜•íƒœë¡œ ì·¨ê¸‰í•œë‹¤. ë¬¸ì„œì˜ **ì¤‘ì²© êµ¬ì¡°ê°€ ë§ì•„ ë°ì´í„° í¬ê¸°ê°€ ì»¤ì§ˆ ê°€ëŠ¥ì„±ì´ ë†’ë‹¤.**
    - ì´ ê²½ìš° JSON ì¤‘ì²©êµ¬ì¡°ê°€ ë§ì•„ ë¬¸ì„œì˜ ë‚´ìš©ì´ ê¸¸ì–´ì§ˆìˆ˜ë¡ JSON í¬ê¸°ê°€ ë§¤ìš° ë¹ ë¥´ê²Œ ì»¤ì§ˆê²ƒìœ¼ë¡œ ì˜ˆìƒëœë‹¤.
    - ì‹¤ì œë¡œ ë™ì¼í•œ `"type"`, `"content"` í‚¤ê°€ ë°˜ë³µë˜ëŠ”ê²ƒì„ í™•ì¸

2. **Base64 ì¸ì½”ë”©ì€ ë¹„íš¨ìœ¨ì **
    - Base64ëŠ” ë°ì´í„° í¬ê¸°ë¥¼ ì•½ 33% ì¦ê°€ì‹œí‚¤ë¯€ë¡œ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.
    - ëŒ€ì‹  **zlib(Gzip) ì••ì¶•ì„ ì ìš©í•˜ë©´ JSON í¬ê¸°ë¥¼ í‰ê·  50~80% ì¤„ì¼ ìˆ˜ ìˆë‹¤.**

3. **ë°±ì—”ë“œ ë¶€í•˜ë¥¼ ì¤„ì´ê³  í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì²˜ë¦¬**
    - ì••ì¶•/í•´ì œ ê³¼ì •ì—ì„œ CPU ë¶€í•˜ê°€ ë°œìƒí•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, **ê°€ëŠ¥í•œ í•œ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì²˜ë¦¬**í•˜ëŠ” êµ¬ì¡°ë¥¼ ì„ íƒ.
    - ë°±ì—”ë“œëŠ” **DB ì €ì¥ ë° ë„¤íŠ¸ì›Œí¬ ì „ì†¡ë§Œ ë‹´ë‹¹í•˜ê³ , í´ë¼ì´ì–¸íŠ¸ê°€ ì••ì¶•ì„ í•´ì œí•˜ë„ë¡ ì„¤ê³„.**

---

## ğŸ› ï¸ ìµœì í™” ë°©ì‹

### âœ… 1. ê°œë³„ ë…¸íŠ¸`content` í•„ë“œ ì••ì¶• ìµœì í™”
  - Plate ì—ë””í„° ë¡œ ì‘ì„±í•œ `content` í•„ë“œì˜ JSON ì— zlib ì••ì¶• ì ìš©.
  - **DB ì €ì¥ ê³µê°„ ì ˆì•½** ë° **ë‹¨ì¼ ë…¸íŠ¸ ì „ì†¡ ì‹œ ìµœì í™” íš¨ê³¼**.

```js filename="noteCompressor.js"
import zlib from 'zlib';

export const getCompressor = (mode) => {
  return mode === 'editor' ? compressEditorContent : compressTextContent;
};

export const getDecompressor = (mode) => {
  return mode === 'editor' ? decompressEditorContent : decompressTextContent;
};

const compressEditorContent = (content) => {
  try {
    return zlib.gzipSync(JSON.stringify(content));
  } catch (error) {
    console.error('ì—ë””í„° ëª¨ë“œ ì••ì¶• ì‹¤íŒ¨', error);
    return content;
  }
};

const decompressEditorContent = (compressedContent) => {
  try {
    return JSON.parse(zlib.gunzipSync(Buffer.from(compressedContent, 'base64')));
  } catch (error) {
    console.error('ì—ë””í„° ëª¨ë“œ ë³µì› ì‹¤íŒ¨', error);
    return compressedContent;
  }
};

// í…ìŠ¤íŠ¸ ë³€í™˜ ë¶€ë¶„ì€ ìƒëµ

```

---


### âœ… **2. `/sync/all` ìš”ì²­ ìµœì í™” (ëŒ€ëŸ‰ JSON ë°ì´í„° ì „ì†¡)**
  - ê°œë³„ ë…¸íŠ¸ê°€ ì•„ë‹ˆë¼ **í•œ ë²ˆì— ë§ì€ ë°ì´í„°ë¥¼ ë™ê¸°í™”í•˜ëŠ”** `/sync/all` ìš”ì²­ì˜ ê²½ìš°, ìš”ì²­ ì „ì²´ë¥¼ ì••ì¶•í•˜ì—¬ ì‘ë‹µ.
  - **ì „ì²´ JSONì„ Gzip ì••ì¶• í›„ ì „ì†¡í•˜ì—¬ ë„¤íŠ¸ì›Œí¬ ë¹„ìš©ì„ ì ˆê°**.
  - **AxiosëŠ” `Content-Encoding: gzip`ì„ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•˜ë¯€ë¡œ, í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë³„ë„ì˜ ì••ì¶• í•´ì œ ì‘ì—…ì´ í•„ìš” ì—†ìŒ.**

#### **ğŸ”¹ ë°±ì—”ë“œ (`syncController.js`)**
```js
const zlib = require("zlib");

exports.syncAllController = async (req, res) => {
  try {
    const userId = req.user.id;
    const [notes, categories, tags] = await Promise.all([
      getNotes(userId),
      getCategories(userId),
      getTags(userId),
    ]);

    const jsonData = JSON.stringify({ notes, categories, tags });
    const compressedData = zlib.gzipSync(jsonData);

    res.setHeader("Content-Type", "application/json");
    res.setHeader("Content-Encoding", "gzip");
    res.send(compressedData);
  } catch (error) {
    const { statusCode, message } = createErrorResponse(error.status || 500, error.message || "ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    res.status(statusCode).json({ message });
  }
};
```

#### **ğŸ”¹ í´ë¼ì´ì–¸íŠ¸ (`syncAPIService.js`)**
```js
const response = await apiClient.get("/sync/all", {
  responseType: "json", // Axiosê°€ ìë™ìœ¼ë¡œ Gzip í•´ì œ
});
const { notes, categories, tags } = response.data;
```


## âœ… ê²°ê³¼

<br/>

<DocsImage src={dimg.notes.binary}/>

<span className="flex justify-center my-8">

*(gif ë¥¼ ë”°ë¡œ ì´¬ì˜í•´ì„œ ì˜ˆì‹œ ë¬¸êµ¬ê°€ ë‹¤ë¥¸ì  ì–‘í•´ ë¶€íƒë“œë¦½ë‹ˆë‹¤.)*

</span>

<br/>

### ğŸš€ ì„±ëŠ¥ ê°œì„  íš¨ê³¼

<div className="max-h-96 overflow-auto border-y rounded-md mt-8">

```python filename="compare_note_performance.py"
import json
import base64
import zlib
import pandas as pd

plate_editor_json = {
    "type": "doc",
    "content": [
        {
            "type": "paragraph",
            "content": [
                {"type": "text", "text": "ì´ê²ƒì€ Plate Editorì—ì„œ ì‘ì„±ëœ ë…¸íŠ¸ì˜ ì˜ˆì œì…ë‹ˆë‹¤."}
            ]
        },
        {
            "type": "paragraph",
            "content": [
                {"type": "text", "text": "Plate EditorëŠ” JSON í˜•íƒœë¡œ ë¬¸ì„œë¥¼ ì €ì¥í•©ë‹ˆë‹¤."}
            ]
        },
        {
            "type": "bulletList",
            "content": [
                {
                    "type": "listItem",
                    "content": [
                        {
                            "type": "paragraph",
                            "content": [
                                {"type": "text", "text": "ëª©ë¡ í•­ëª© 1"}
                            ]
                        }
                    ]
                },
                {
                    "type": "listItem",
                    "content": [
                        {
                            "type": "paragraph",
                            "content": [
                                {"type": "text", "text": "ëª©ë¡ í•­ëª© 2"}
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "type": "blockquote",
            "content": [
                {
                    "type": "paragraph",
                    "content": [
                        {"type": "text", "text": "ì´ê²ƒì€ ì¸ìš©ë¬¸ ì˜ˆì œì…ë‹ˆë‹¤.", "marks": [{"type": "italic"}]}
                    ]
                }
            ]
        },
        {
            "type": "codeBlock",
            "attrs": {"language": "javascript"},
            "content": [
                {"type": "text", "text": "console.log('Hello, World!');"}
            ]
        }
    ]
}


# JSON ë°ì´í„°ë¥¼ ë¬¸ìì—´ë¡œ ë³€í™˜
json_str = json.dumps(plate_editor_json, ensure_ascii=False)

# 1. JSON ê·¸ëŒ€ë¡œ í¬ê¸° (UTF-8)
json_bytes = json_str.encode('utf-8')
json_size = len(json_bytes)

# 2. Base64ë¡œ ë³€í™˜ í›„ í¬ê¸°
base64_encoded = base64.b64encode(json_bytes)
base64_size = len(base64_encoded)

# 3. ë°”ì´ë„ˆë¦¬ ì••ì¶• (zlib ì‚¬ìš©)
compressed_binary = zlib.compress(json_bytes)
compressed_size = len(compressed_binary)

# ê²°ê³¼ ë¹„êµ
comparison_results = {
    "JSON (ì›ë³¸)": json_size,
    "Base64 ë³€í™˜": base64_size,
    "ë°”ì´ë„ˆë¦¬ ì••ì¶• (zlib)": compressed_size,
}

# ê²°ê³¼ í‘œì‹œ
df = pd.DataFrame(list(comparison_results.items()), columns=["ë°©ì‹", "í¬ê¸° (ë°”ì´íŠ¸)"])
print(df)

```

</div>

<span className="flex justify-center my-8">

*ìš©ëŸ‰ ê³„ì‚° íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸*

</span>

<br/>

| ì „ì†¡ ë°©ì‹ | ë°ì´í„° í¬ê¸° (ì˜ˆì œ ê¸°ì¤€) |
|-----------|------------------|
| JSON (ì›ë³¸) | 853 ë°”ì´íŠ¸ |
| Base64 ë³€í™˜ | 1140 ë°”ì´íŠ¸ (33.65% ì¦ê°€) |
| Gzip ì••ì¶• | 334 ë°”ì´íŠ¸ (60.84% ê°ì†Œ) |

- ì••ì¶• ì ìš© í›„ ì „ì†¡ ë°ì´í„° í¬ê¸°ê°€ **í‰ê·  5~60% ê°ì†Œ**
- ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ ë° ë¡œë”© ì†ë„ ìµœì í™”
- DB ì €ì¥ ê³µê°„ ì ˆì•½

---

## ğŸ’¡ ë°°ìš´ ì 
- JSON ë°ì´í„°ë¥¼ ë°”ì´ë„ˆë¦¬ ì••ì¶•í•˜ë©´ í° ì„±ëŠ¥ í–¥ìƒì„ ê¸°ëŒ€í•  ìˆ˜ ìˆìŒ.
- Base64 ë³€í™˜ì€ ì˜¤íˆë ¤ í¬ê¸°ë¥¼ ì¦ê°€ì‹œí‚¤ë¯€ë¡œ í”¼í•˜ëŠ” ê²ƒì´ ì¢‹ìŒ.
- ë°ì´í„° ì €ì¥ ë° ì „ì†¡ ìµœì í™”ë¥¼ ìœ„í•´ ë‹¤ì–‘í•œ ì••ì¶• ê¸°ë²•ì„ ê³ ë ¤í•  í•„ìš”ê°€ ìˆìŒ.